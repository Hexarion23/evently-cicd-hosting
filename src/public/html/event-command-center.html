<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Event Command Center - Evently</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />

    <link rel="stylesheet" href="../css/styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="../js/navbar.js" type="module" defer></script>
  </head>

  <body class="app-shell">
    <div class="container py-4">
      <div class="mb-4">
        <div class="d-flex align-items-center gap-2 mb-2">
          <span class="badge bg-primary px-3 py-2">Event Analysis</span>
        </div>
        <h1 class="h2 fw-bold mb-1" id="eventTitle">Loading Event...</h1>
        <p id="eventMeta" class="text-muted mb-0">
          <i class="bi bi-calendar-event me-2"></i>--
        </p>
      </div>

      <div class="row g-3 mb-4">
        <div class="col-md-4">
          <div class="metric-card p-3 shadow-sm border-0 h-100">
            <span class="mini text-muted">Total Signups</span>
            <div class="mt-2 h2 fw-bold mb-0" id="statSignups">--</div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="metric-card p-3 shadow-sm border-0 h-100">
            <span class="mini text-muted">Actual Attendance</span>
            <div class="mt-2 h2 fw-bold mb-0 text-success" id="statAttended">
              --
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="metric-card p-3 shadow-sm border-0 h-100">
            <span class="mini text-muted">Turnout Rate</span>
            <div class="mt-2 h2 fw-bold mb-0" id="statRate">--%</div>
          </div>
        </div>
      </div>

      <div class="row g-3">
        <div class="col-lg-7">
          <div class="section-card p-4 h-100">
            <h5 class="fw-bold mb-4">Turnout Comparison</h5>
            <div style="height: 300px">
              <canvas id="eventAttendanceChart"></canvas>
            </div>
          </div>
        </div>

        <div class="col-lg-5">
          <div class="section-card p-4 h-100">
            <h5 class="fw-bold mb-3">Management Tools</h5>
            <div class="d-grid gap-3">
              <button
                class="btn btn-light border py-3 text-start"
                onclick="exportAttendanceList()"
              >
                <i class="bi bi-file-earmark-pdf me-2 text-danger"></i> Export
                Attendance List
              </button>
              <a
                id="qrLink"
                href="qr-scanner.html"
                class="btn btn-light border py-3 text-start"
              >
                <i class="bi bi-qr-code-scan me-2 text-primary"></i> Launch
                Event QR Scanner
              </a>
              <button
                class="btn btn-light border py-3 text-start"
                onclick="showParticipantsModal()"
              >
                <i class="bi bi-envelope-at me-2 text-warning"></i> Email
                Participants
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="row g-3 mt-1">
        <div class="col-lg-3">
          <div class="section-card p-4 h-100">
            <h5 class="fw-bold mb-1">Feedback Score</h5>
            <p class="small text-muted mb-4">Average participant rating</p>
            <div class="text-center py-3">
              <div
                class="display-4 fw-bold text-primary mb-1"
                id="statAvgRating"
              >
                --
              </div>
              <div class="text-warning mb-2" id="starRatingContainer">
                <i class="bi bi-star"></i><i class="bi bi-star"></i
                ><i class="bi bi-star"></i><i class="bi bi-star"></i
                ><i class="bi bi-star"></i>
              </div>
              <span class="text-muted small" id="totalFeedbackCount"
                >0 responses</span
              >
            </div>
          </div>
        </div>

        <div class="col-lg-9">
          <div class="section-card p-4 h-100">
            <div class="d-flex justify-content-between align-items-center mb-4">
              <h5 class="fw-bold mb-0">Rating Distribution</h5>
              <button
                class="btn btn-sm btn-outline-primary"
                onclick="viewAllComments()"
              >
                <i class="bi bi-chat-left-text me-1"></i> View Comments
              </button>
            </div>
            <div style="height: 250px">
              <canvas id="feedbackDistributionChart"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Participants Modal -->
    <div
      class="modal fade"
      id="participantsModal"
      tabindex="-1"
      aria-labelledby="participantsModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title fw-bold" id="participantsModalLabel">
              Event Participants
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <div>
                <h6 id="modalEventTitle" class="mb-0"></h6>
                <small class="text-muted" id="modalEventDate"></small>
              </div>
              <div>
                <button
                  class="btn btn-sm btn-outline-primary me-2"
                  onclick="selectAllParticipants()"
                >
                  <i class="bi bi-check-square"></i> Select All
                </button>
                <button
                  class="btn btn-sm btn-primary"
                  onclick="sendEmailToSelected()"
                >
                  <i class="bi bi-send"></i> Email Selected
                </button>
              </div>
            </div>

            <div class="table-responsive">
              <table class="table table-hover align-middle">
                <thead>
                  <tr>
                    <th width="50">
                      <input
                        type="checkbox"
                        id="selectAllCheckbox"
                        onchange="toggleSelectAll(this)"
                      />
                    </th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Status</th>
                    <th>Signed Up</th>
                  </tr>
                </thead>
                <tbody id="participantsTableBody">
                  <tr>
                    <td colspan="5" class="text-center py-4">
                      <div
                        class="spinner-border spinner-border-sm text-primary me-2"
                        role="status"
                      ></div>
                      Loading participants...
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="mt-4">
              <div class="form-group">
                <label class="form-label fw-semibold">Email Template:</label>
                <div class="d-flex gap-2 mb-2">
                  <button
                    class="btn btn-sm btn-outline-secondary"
                    onclick="useReminderTemplate()"
                  >
                    Reminder
                  </button>
                  <button
                    class="btn btn-sm btn-outline-secondary"
                    onclick="useThankYouTemplate()"
                  >
                    Thank You
                  </button>
                  <button
                    class="btn btn-sm btn-outline-secondary"
                    onclick="useFollowUpTemplate()"
                  >
                    Follow-up
                  </button>
                </div>
                <textarea
                  class="form-control"
                  id="emailTemplate"
                  rows="6"
                  placeholder="Compose your email..."
                ></textarea>
              </div>

              <div class="form-group mt-3">
                <label class="form-label fw-semibold">Email Subject:</label>
                <input
                  type="text"
                  class="form-control"
                  id="emailSubject"
                  placeholder="Email subject..."
                />
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-outline-secondary"
              onclick="exportAttendanceList()"
            >
              <i class="bi bi-download me-1"></i> Export CSV
            </button>
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
            <button
              type="button"
              class="btn btn-primary"
              onclick="sendEmailToSelected()"
            >
              <i class="bi bi-send me-1"></i> Send Email
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="feedbackModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content border-0 shadow-lg">
          <div class="modal-header border-bottom-0 pb-0">
            <h5 class="modal-title fw-bold">Participant Comments</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body pt-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <span class="text-muted small" id="feedbackCount"
                >0 comments found</span
              >
            </div>

            <div
              id="feedbackList"
              class="list-group list-group-flush"
              style="max-height: 500px; overflow-y: auto"
            >
              <div class="text-center py-5 text-muted">
                <i class="bi bi-chat-square-dots fs-1 d-block mb-2"></i>
                No comments available.
              </div>
            </div>
          </div>
          <div class="modal-footer border-top-0">
            <button
              type="button"
              class="btn btn-secondary px-4"
              data-bs-dismiss="modal"
            >
              Close
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../js/event-command-center.js"></script>
  </body>
</html>
