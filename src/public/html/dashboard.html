<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard - Evently</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.min.css"
    />

    <link rel="stylesheet" href="../css/styles.css" />
    <script src="../js/navbar.js" type="module" defer></script>
  </head>

  <body class="app-shell">
    <div class="container-fluid px-4 py-4">
      <div class="row mb-4">
        <div class="col-12">
          <div
            class="d-flex justify-content-between align-items-center flex-wrap gap-3"
          >
            <div>
              <h1 class="h2 fw-bold mb-1">Event Dashboard</h1>
              <p class="text-muted mb-0">
                Discover and manage campus events at Singapore Polytechnic
              </p>
            </div>

            <button
              id="createEventBtn"
              class="btn btn-primary d-none"
              data-bs-toggle="modal"
              data-bs-target="#createEventModal"
            >
              <i class="bi bi-plus-lg me-2"></i>Create Event
            </button>
          </div>
        </div>
      </div>

      <div class="row g-4 mb-4" id="statsCards"></div>

      <section class="mt-4">
        <div
          class="card border-0"
          style="
            background: linear-gradient(
              135deg,
              rgba(200, 16, 46, 0.04),
              rgba(200, 16, 46, 0.02)
            );
            border: 1px solid rgba(200, 16, 46, 0.12) !important;
          "
        >
          <div
            class="card-body d-flex justify-content-between align-items-center p-4"
          >
            <div>
              <div class="d-flex align-items-center gap-2 mb-2">
                <div
                  style="
                    width: 40px;
                    height: 40px;
                    border-radius: 12px;
                    background: linear-gradient(135deg, #c8102e, #a00d24);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                  "
                >
                  <i class="bi bi-lightning-charge-fill text-white"></i>
                </div>
                <h5 class="mb-0 fw-bold">Your Event Engagement</h5>
              </div>
              <p id="engagementLevel" class="text-muted mb-1">Loading...</p>
              <small id="engagementStats" class="text-muted"></small>
            </div>
            <div class="text-end">
              <div class="display-5 fw-bold text-gradient" id="engagementScore">
                -
              </div>
              <small class="text-muted">Engagement Score</small>
            </div>
          </div>
        </div>
      </section>

      <section class="mt-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <div class="d-flex align-items-center gap-2">
            <i class="bi bi-stars" style="color: #c8102e"></i>
            <h5 class="mb-0 fw-bold">Recommended for You</h5>
          </div>
          <span
            class="badge"
            style="
              background: rgba(200, 16, 46, 0.08);
              color: #c8102e;
              font-weight: 500;
            "
            >Based on your history & CCA</span
          >
        </div>
        <div id="recommendedEventsList" class="row g-3"></div>
      </section>

      <div class="row mb-4 mt-4">
        <div class="col-12">
          <div class="card border-0">
            <div class="card-body p-4">
              <div class="row g-3 align-items-end">
                <div class="col-md-5">
                  <label class="form-label small fw-semibold text-muted mb-2"
                    >Search Events</label
                  >
                  <div class="input-group">
                    <span
                      class="input-group-text bg-white border-end-0"
                      style="border: 2px solid #e9ecef; border-right: none"
                    >
                      <i class="bi bi-search text-muted"></i>
                    </span>
                    <input
                      type="text"
                      class="form-control border-start-0"
                      id="searchInput"
                      placeholder="Search by name, CCA, location..."
                      style="border: 2px solid #e9ecef; border-left: none"
                    />
                  </div>
                </div>

                <div class="col-md-3">
                  <label class="form-label small fw-semibold text-muted mb-2"
                    >Sort By</label
                  >
                  <select class="form-select" id="sortFilter">
                    <option value="date">Sort by Date</option>
                    <option value="points">Sort by Points</option>
                  </select>
                </div>

                <div class="col-md-2">
                  <button
                    class="btn btn-outline-secondary w-100"
                    id="clearFiltersBtn"
                  >
                    <i class="bi bi-x-circle me-2"></i>Clear
                  </button>
                </div>
              </div>

              <div class="row mt-4">
                <div class="col-12">
                  <label class="form-label small fw-semibold text-muted mb-2"
                    >Filter by Type</label
                  >
                  <div
                    class="d-flex flex-wrap gap-2"
                    role="group"
                    id="eventTypeFilters"
                  >
                    <input
                      type="radio"
                      class="btn-check"
                      name="eventType"
                      id="allEvents"
                      value="all"
                      checked
                    />
                    <label
                      class="btn btn-outline-primary"
                      for="allEvents"
                      style="border-radius: 20px; padding: 0.5rem 1.25rem"
                    >
                      All Events
                    </label>

                    <input
                      type="radio"
                      class="btn-check"
                      name="eventType"
                      id="polywideEvents"
                      value="poly-wide"
                    />
                    <label
                      class="btn btn-outline-primary"
                      for="polywideEvents"
                      style="border-radius: 20px; padding: 0.5rem 1.25rem"
                    >
                      Poly-wide
                    </label>

                    <input
                      type="radio"
                      class="btn-check"
                      name="eventType"
                      id="myCCAEvents"
                      value="my-cca"
                    />
                    <label
                      class="btn btn-outline-primary"
                      for="myCCAEvents"
                      style="border-radius: 20px; padding: 0.5rem 1.25rem"
                    >
                      My CCA
                    </label>

                    <input
                      type="radio"
                      class="btn-check d-none"
                      name="eventType"
                      id="myManagedEvents"
                      value="my-managed"
                    />
                    <label
                      class="btn btn-outline-primary d-none"
                      for="myManagedEvents"
                      style="border-radius: 20px; padding: 0.5rem 1.25rem"
                      >Events I Manage</label
                    >

                    <input
                      type="radio"
                      class="btn-check d-none"
                      name="eventType"
                      id="otherCCAEvents"
                      value="other-cca"
                    />
                    <label
                      class="btn btn-outline-primary d-none"
                      for="otherCCAEvents"
                      style="border-radius: 20px; padding: 0.5rem 1.25rem"
                      >Other CCA</label
                    >
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row g-4 mb-4" id="eventsGrid"></div>

      <div class="row d-none" id="emptyState">
        <div class="col-12">
          <div class="card border-0">
            <div class="card-body text-center py-5">
              <div
                style="
                  width: 80px;
                  height: 80px;
                  border-radius: 20px;
                  background: rgba(200, 16, 46, 0.08);
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  margin: 0 auto 1.5rem;
                "
              >
                <i
                  class="bi bi-calendar-x"
                  style="font-size: 2rem; color: #c8102e"
                ></i>
              </div>
              <h4 class="fw-bold mb-2">No events found</h4>
              <p class="text-muted mb-0">
                Try adjusting your filters or check back later
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="createEventModal" tabindex="-1">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content shadow">
          <div class="modal-header">
            <h5 class="modal-title fw-bold">Create New Event</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>

          <div class="modal-body">
            <form id="createEventForm" class="row g-3">
              <div class="col-md-6">
                <label class="form-label fw-semibold">Event Title</label>
                <input
                  type="text"
                  class="form-control"
                  id="eventTitle"
                  required
                />
              </div>

              <div class="col-md-6">
                <label class="form-label fw-semibold">Visibility</label>
                <select class="form-select" id="eventVisibility" required>
                  <option value="poly-wide">Poly-wide</option>
                  <option value="cca-specific">CCA Specific</option>
                </select>
              </div>

              <div class="col-12">
                <label class="form-label fw-semibold">Description</label>
                <textarea
                  class="form-control"
                  id="eventDescription"
                  rows="3"
                ></textarea>
              </div>

              <div class="col-md-6">
                <label class="form-label fw-semibold">Start Date & Time</label>
                <input
                  type="datetime-local"
                  class="form-control"
                  id="eventStart"
                  required
                />
              </div>

              <div class="col-md-6">
                <label class="form-label fw-semibold">End Date & Time</label>
                <input
                  type="datetime-local"
                  class="form-control"
                  id="eventEnd"
                  required
                />
              </div>

              <div class="col-md-6">
                <label class="form-label fw-semibold">Location</label>
                <input
                  type="text"
                  class="form-control"
                  id="eventLocation"
                  required
                />
              </div>

              <div class="col-md-6">
                <label class="form-label fw-semibold">Capacity</label>
                <input
                  type="number"
                  class="form-control"
                  id="eventCapacity"
                  min="1"
                  required
                />
              </div>

              <div class="col-md-6">
                <label class="form-label fw-semibold"
                  >CCA Points Category</label
                >
                <select class="form-select" id="eventPointsCategory">
                  <option value="">None</option>
                  <option value="Service">Service</option>
                  <option value="Community Service">Community Service</option>
                  <option value="Enrichment">Enrichment</option>
                  <option value="Participation">Participation</option>
                </select>
              </div>

              <div class="col-md-6">
                <label class="form-label fw-semibold">Sign-up Deadline</label>
                <input
                  type="datetime-local"
                  class="form-control"
                  id="eventSignUpDeadline"
                />
              </div>

              <div class="col-md-6">
                <label class="form-label fw-semibold"
                  >CCA Points (numeric)</label
                >
                <input
                  type="number"
                  class="form-control"
                  id="eventCcaPoints"
                  min="0"
                  step="1"
                />
              </div>

              <div class="col-12">
                <label class="form-label fw-bold text-danger"
                  >Proposal Document (Required)</label
                >
                <input
                  type="file"
                  class="form-control"
                  id="eventProposal"
                  accept=".pdf,.doc,.docx"
                  required
                />
                <div class="form-text text-muted">
                  Upload the detailed proposal for Teacher approval.
                </div>
              </div>

              <div class="col-12">
                <label class="form-label fw-bold text-danger"
                  >Event Image (Required)</label
                >

                <div class="d-flex gap-3 mb-3 p-2 border rounded bg-light">
                  <div
                    class="preset-option text-center"
                    style="flex: 1; cursor: pointer"
                  >
                    <img
                      src="../assets/academic.jpg"
                      class="img-thumbnail preset-img"
                      data-path="../assets/academic.jpg"
                      style="height: 60px; width: 100%; object-fit: cover"
                    />
                    <small class="d-block mt-1">Academic</small>
                  </div>
                  <div
                    class="preset-option text-center"
                    style="flex: 1; cursor: pointer"
                  >
                    <img
                      src="../assets/social.jpg"
                      class="img-thumbnail preset-img"
                      data-path="../assets/social.jpg"
                      style="height: 60px; width: 100%; object-fit: cover"
                    />
                    <small class="d-block mt-1">Social</small>
                  </div>
                  <div
                    class="preset-option text-center"
                    style="flex: 1; cursor: pointer"
                  >
                    <img
                      src="../assets/sports.jpeg"
                      class="img-thumbnail preset-img"
                      data-path="../assets/sports.jpeg"
                      style="height: 60px; width: 100%; object-fit: cover"
                    />
                    <small class="d-block mt-1">Sports</small>
                  </div>
                </div>

                <div class="text-center mb-2">
                  <small class="text-muted">— OR UPLOAD CUSTOM —</small>
                </div>

                <input
                  type="file"
                  class="form-control"
                  id="eventImage"
                  accept="image/*"
                />
                <input type="hidden" id="selectedPresetPath" value="" />

                <img
                  id="eventImagePreview"
                  class="mt-3 img-thumbnail d-none mx-auto d-block"
                  style="
                    max-width: 200px;
                    max-height: 150px;
                    border: 2px solid var(--sp-red);
                  "
                />
              </div>

              <div class="col-12">
                <hr class="my-3" />
                <h6 class="fw-semibold mb-3">Event Details (Optional)</h6>
              </div>

              <div class="col-12">
                <label class="form-label fw-semibold">Agenda</label>
                <textarea
                  class="form-control"
                  id="eventAgenda"
                  rows="3"
                  placeholder="Outline the event agenda..."
                ></textarea>
              </div>

              <div class="col-12">
                <label class="form-label fw-semibold">Requirements</label>
                <textarea
                  class="form-control"
                  id="eventRequirements"
                  rows="3"
                  placeholder="List any requirements or prerequisites..."
                ></textarea>
              </div>

              <div class="col-12">
                <label class="form-label fw-semibold">Notes</label>
                <textarea
                  class="form-control"
                  id="eventNotes"
                  rows="3"
                  placeholder="Additional notes..."
                ></textarea>
              </div>

              <div class="col-12">
                <label class="form-label fw-semibold">Safety Guidelines</label>
                <textarea
                  class="form-control"
                  id="eventSafetyGuidelines"
                  rows="3"
                  placeholder="Describe safety guidelines and precautions..."
                ></textarea>
              </div>

              <div class="col-md-4">
                <label class="form-label fw-semibold">Contact Person</label>
                <input
                  type="text"
                  class="form-control"
                  id="eventContactPerson"
                  placeholder="Name"
                />
              </div>

              <div class="col-md-4">
                <label class="form-label fw-semibold">Contact Email</label>
                <input
                  type="email"
                  class="form-control"
                  id="eventContactEmail"
                  placeholder="email@example.com"
                />
              </div>

              <div class="col-md-4">
                <label class="form-label fw-semibold">Contact Phone</label>
                <input
                  type="text"
                  class="form-control"
                  id="eventContactPhone"
                  placeholder="+65 XXXX XXXX"
                />
              </div>
            </form>
          </div>

          <div class="modal-footer">
            <button class="btn btn-secondary" data-bs-dismiss="modal">
              Cancel
            </button>
            <button class="btn btn-primary" id="submitEventBtn">
              <i class="bi bi-check-lg me-2"></i> Submit for Approval
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script>
      const SUPABASE_URL = "https://fyfyvadrabgptmbiuvcl.supabase.co";
      const SUPABASE_KEY =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ5Znl2YWRyYWJncHRtYml1dmNsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyMDE5OTYsImV4cCI6MjA3ODc3Nzk5Nn0.kcqDjL3ZaZVOlVU7sDlcl6x5MxrWPlZ_681hzYbbSbQ";

      window.supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../js/utils.js"></script>
    <script src="../js/notifications.js"></script>
    <script src="../js/dashboard-notifications.js"></script>
    <script src="../js/footer.js" defer></script>
    <script src="../js/dashboard.js"></script>
    <script src="../js/data.js"></script>

    <script src="../js/dashboard-engagement.js"></script>

    <link rel="stylesheet" href="../css/chatbot.css" />
    <div id="chatbot-container">
      <button id="chatbot-fab" class="chatbot-fab" title="Open AI Assistant">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path
            d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"
          ></path>
        </svg>
      </button>

      <div id="chatbot-modal" class="chatbot-modal hidden">
        <div class="chatbot-header">
          <div class="chatbot-title">
            <h3>AI Assistant</h3>
            <p>Ask me anything about this website</p>
          </div>
          <button
            id="chatbot-close"
            class="chatbot-close"
            title="Close chatbot"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>

        <div id="chatbot-messages" class="chatbot-messages">
          <div class="chatbot-message bot-message">
            <div class="message-content">
              <p>Hi! I'm your AI Assistant. How can I help you today?</p>
            </div>
          </div>
        </div>

        <div class="chatbot-input-area">
          <input
            id="chatbot-input"
            type="text"
            class="chatbot-input"
            placeholder="Type your message..."
            autocomplete="off"
          />
          <button id="chatbot-send" class="chatbot-send" title="Send message">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <line x1="22" y1="2" x2="11" y2="13"></line>
              <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
            </svg>
          </button>
        </div>
      </div>
    </div>
    <script src="../js/chatbot.js"></script>
    <script src="../js/footer.js" defer></script>
  </body>
</html>
